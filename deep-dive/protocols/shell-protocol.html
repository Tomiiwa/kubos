

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Shell Protocol &mdash; Kubos 1.21.0+12 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/kubos_favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Kubos 1.21.0+12 documentation" href="../../index.html"/>
        <link rel="up" title="Under the Hood of KubOS" href="../index.html"/>
        <link rel="next" title="Configuring Kubos Linux" href="../klb/configuring-kubos.html"/>
        <link rel="prev" title="File Transfer Protocol" href="file-protocol.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Kubos
          

          
          </a>

          
            
            
              <div class="version">
                1.21.0+12
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../kubos-design.html">KubOS Design</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../obc-docs/index.html">Working with an OBC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mission-dev/index.html">Mission Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem/index.html">KubOS Ecosystem</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Under the Hood</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#apis">APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#protocols">Protocols</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="file-protocol.html">File Protocol Overview</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Shell Protocol Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#apis">APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#messages">Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-usages">Example Usages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#future-messages">Future Messages</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#kubos-linux">Kubos Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#design-decisions">Design Decisions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../sdk-docs/index.html">Kubos SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing to KubOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq-troubleshooting.html">FAQs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Kubos</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Under the Hood of KubOS</a> &raquo;</li>
        
      <li>Shell Protocol</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/deep-dive/protocols/shell-protocol.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="shell-protocol">
<h1>Shell Protocol<a class="headerlink" href="#shell-protocol" title="Permalink to this headline">¶</a></h1>
<p>The shell protocol is implemented by both the
<a class="reference internal" href="../../ecosystem/services/shell.html"><span class="doc">shell service</span></a> and any clients interfacing
with the service.</p>
<p>All messages in the shell protocol are encoded as <cite>CBOR</cite> arrays
and are sent in UDP packets. The first value in the encoded list
is the <code class="docutils literal notranslate"><span class="pre">channel_id</span></code>. The second value will be the <code class="docutils literal notranslate"><span class="pre">command</span></code>
and any additional values will be parameters for the <code class="docutils literal notranslate"><span class="pre">command</span></code>.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">command,</span> <span class="pre">parameters..</span> <span class="pre">}</span></code></div></blockquote>
<div class="section" id="apis">
<h2>APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a href="../../rust-docs/shell_protocol/index.html" target="_blank">Shell Protocol</a></li>
<li><a href="../../rust-docs/cbor_protocol/index.html" target="_blank">CBOR Protocol</a></li>
<li><a href="../../rust-docs/channel_protocol/index.html" target="_blank">Channel Protocol</a></li>
</ul>
<blockquote>
<div></div></blockquote>
</div>
<div class="section" id="messages">
<h2>Messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h2>
<p>The primary purpose of the shell protocol is to allow the
spawning and controlling of remote processes. These messages
are used by shell clients to direct the shell service in
this work of manipulating processes.</p>
<div class="section" id="spawn-process">
<h3>Spawn Process<a class="headerlink" href="#spawn-process" title="Permalink to this headline">¶</a></h3>
<p>This message is sent to the shell service to request a child
process to be spawned. It contains a channel ID, the string
‘spawn’, a command, and spawn options. The command can be an
absolute path to a binary or something in the system <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'spawn',</span> <span class="pre">command,</span> <span class="pre">options..</span> <span class="pre">}</span></code></div></blockquote>
<p>There is currently only one available option for the <code class="docutils literal notranslate"><span class="pre">options</span></code>
argument:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">args</span></code> - An array of arguments to pass to the child process</li>
</ul>
</div></blockquote>
<p>Example of starting a shell:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">1,</span> <span class="pre">'spawn',</span> <span class="pre">'sh',</span> <span class="pre">{</span> <span class="pre">args</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">'-l'</span> <span class="pre">}</span> <span class="pre">}</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="write-to-stdin">
<h3>Write to Stdin<a class="headerlink" href="#write-to-stdin" title="Permalink to this headline">¶</a></h3>
<p>This message is sent to the shell service to write data
to the stdin of a child process. It contains a channel ID,
the string ‘stdin’, and a data string. The data string
will be written directly to the stdin of the child process.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'stdin',</span> <span class="pre">data</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="close-stdin">
<h3>Close Stdin<a class="headerlink" href="#close-stdin" title="Permalink to this headline">¶</a></h3>
<p>This message is sent to the shell service to close the
stdin of a child process. It contains a channel ID and
the string ‘stdin’.</p>
<p>After this message is received the shell service will close
the stdin pipe for the specified child process. Any future
messages attempting to write to stdin for this process will
result in an error.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'stdin'</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="send-signal">
<h3>Send Signal<a class="headerlink" href="#send-signal" title="Permalink to this headline">¶</a></h3>
<p>This message is sent to the shell service to signal a
child process. It contains a channel ID, the string ‘kill’,
and optionally a signal number. If the signal number is
omitted then <cite>SIGTERM</cite> will be sent.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'kill',</span> <span class="pre">signal</span> <span class="pre">}</span></code></div></blockquote>
<p>A list of available signals can be found
<a class="reference external" href="http://man7.org/linux/man-pages/man7/signal.7.html">here</a>.</p>
<p>Example usages:</p>
<p>Send <cite>SIGTERM</cite> to a child process:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'kill'</span> <span class="pre">}</span></code></div></blockquote>
<p>Send <cite>SIGKILL</cite> to a child process:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'kill',</span> <span class="pre">9</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="process-created">
<h3>Process Created<a class="headerlink" href="#process-created" title="Permalink to this headline">¶</a></h3>
<p>This message is sent from the shell service when a process
has been created. It contains the channel ID, the string ‘pid’
and a decimal number which is the pid.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'pid',</span> <span class="pre">pid</span> <span class="pre">}</span></code></div></blockquote>
<p>Example message - A process has been created with a pid of 10:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">1,</span> <span class="pre">'pid',</span> <span class="pre">10</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="stdout-data">
<h3>Stdout Data<a class="headerlink" href="#stdout-data" title="Permalink to this headline">¶</a></h3>
<p>This message is sent from the shell service when a process
has produced data via <cite>stdout</cite>. It contains the channel ID,
the string ‘stdout’, and a string of the stdout data.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'stdout',</span> <span class="pre">data</span> <span class="pre">}</span></code></div></blockquote>
<p>Example message - <code class="docutils literal notranslate"><span class="pre">ls</span></code> producing directory output of <cite>kubos-shell-client</cite>:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">12,</span> <span class="pre">'stdout',</span> <span class="pre">'Cargo.toml\nsrc\n'</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="stdout-closed">
<h3>Stdout Closed<a class="headerlink" href="#stdout-closed" title="Permalink to this headline">¶</a></h3>
<p>This message is sent from the shell service when a process’s
stdout pipe has been closed. It contains the channel ID and
the string ‘stdout’.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'stdout'</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="stderr-data">
<h3>Stderr Data<a class="headerlink" href="#stderr-data" title="Permalink to this headline">¶</a></h3>
<p>This message is sent from the shell service when a process
has produced data via <cite>stderr</cite>. It contains the channel ID,
the string <cite>stderr</cite>, and a string of the stderr data.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'stderr',</span> <span class="pre">data</span> <span class="pre">}</span></code></div></blockquote>
<p>Example message - The result of running <code class="docutils literal notranslate"><span class="pre">ls</span></code> with an invalid argument:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">13,</span> <span class="pre">'stderr',</span> <span class="pre">&quot;Try</span> <span class="pre">'ls</span> <span class="pre">--help'</span> <span class="pre">for</span> <span class="pre">more</span> <span class="pre">information.\n&quot;</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="stderr-closed">
<h3>Stderr Closed<a class="headerlink" href="#stderr-closed" title="Permalink to this headline">¶</a></h3>
<p>This message is sent from the shell service when a process’s
stderr pipe has been closed. It contains the channel ID and
the string ‘stderr’.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'stderr'</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="process-exited">
<h3>Process Exited<a class="headerlink" href="#process-exited" title="Permalink to this headline">¶</a></h3>
<p>This message is sent from the shell service when a process
has exited. It contains the channel ID, the string ‘exit’,
the exit signal and the exit code.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'exit',</span> <span class="pre">code,</span> <span class="pre">signal</span> <span class="pre">}</span></code></div></blockquote>
<p>Example messages</p>
<p>The result of a process exiting normally:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">14,</span> <span class="pre">'exit',</span> <span class="pre">0,</span> <span class="pre">0</span> <span class="pre">}</span></code></div></blockquote>
<p>The result of sending a SIGKILL to a process:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">14,</span> <span class="pre">'exit',</span> <span class="pre">0,</span> <span class="pre">9</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="request-list-of-processes">
<h3>Request List of Processes<a class="headerlink" href="#request-list-of-processes" title="Permalink to this headline">¶</a></h3>
<p>This message is sent to the shell service to request a list
of the current processes running in the shell service. It
contains the channel ID and the string ‘list’.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'list'</span> <span class="pre">}</span></code></div></blockquote>
</div>
<div class="section" id="list-of-processes">
<h3>List of Processes<a class="headerlink" href="#list-of-processes" title="Permalink to this headline">¶</a></h3>
<p>This message is sent from the shell service when a list
of processes is requested. It contains the channel ID,
the string ‘list’, and a list of objects containing
process information (channel_id, path and pid). The
channel ID can be used to communicate with the corresponding
process in the list.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'list',</span> <span class="pre">{</span> <span class="pre">[channel_id]</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">path,</span> <span class="pre">pid</span> <span class="pre">}</span> <span class="pre">}</span> <span class="pre">}</span></code></div></blockquote>
<p>Example list of processes:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">16,</span> <span class="pre">'list',</span> <span class="pre">{</span> <span class="pre">[12]</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">path</span> <span class="pre">=</span> <span class="pre">'sh',</span> <span class="pre">pid</span> <span class="pre">=</span> <span class="pre">45</span> <span class="pre">},</span> <span class="pre">[14]</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">path</span> <span class="pre">=</span> <span class="pre">'sh',</span> <span class="pre">pid</span> <span class="pre">=</span> <span class="pre">50</span> <span class="pre">}</span> <span class="pre">}</span> <span class="pre">}</span></code></div></blockquote>
</div>
</div>
<div class="section" id="example-usages">
<h2>Example Usages<a class="headerlink" href="#example-usages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="running-a-short-lived-process">
<h3>Running a Short-Lived Process<a class="headerlink" href="#running-a-short-lived-process" title="Permalink to this headline">¶</a></h3>
<p>The goal here is to run <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-a</span></code> on a remote machine
via the shell service and see the output. The shell client
randomly chooses <code class="docutils literal notranslate"><span class="pre">35</span></code> as its <code class="docutils literal notranslate"><span class="pre">channel_id</span></code> and sends a
<code class="docutils literal notranslate"><span class="pre">spawn</span></code> command with the arguments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Client</span><span class="p">:</span> <span class="p">{</span> <span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;spawn&#39;</span><span class="p">,</span> <span class="s1">&#39;uname&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;-a&#39;</span><span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>The service sends back multiple messages in quick
succession because this is a short-lived process.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="mi">26191</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;Linux vagrant 4.4.0-128-generic #154-Ubuntu SMP Fri May 25 14:15:18 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux&#39;</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;stderr&#39;</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="running-a-long-lived-process">
<h3>Running a Long-Lived Process<a class="headerlink" href="#running-a-long-lived-process" title="Permalink to this headline">¶</a></h3>
<p>The goal here is to open a <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell on a remote
machine via the shell service and use that shell to
execute commands.</p>
<div class="section" id="starting-the-process">
<h4>Starting the Process<a class="headerlink" href="#starting-the-process" title="Permalink to this headline">¶</a></h4>
<p>The shell client randomly chooses <code class="docutils literal notranslate"><span class="pre">55</span></code> as its <code class="docutils literal notranslate"><span class="pre">channel_id</span></code>
and sends a <code class="docutils literal notranslate"><span class="pre">spawn</span></code> command with the arguments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Client</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;spawn&#39;</span><span class="p">,</span> <span class="s1">&#39;sh&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="n">detached</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="n">pty</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;-l&#39;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p>The service responds back with the <code class="docutils literal notranslate"><span class="pre">pid</span></code> of the newly
created process.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="mi">26825</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\027</span><span class="s1">kvagrant@vagrant:/home/vagrant</span><span class="se">\027\\</span><span class="s1">&#39;</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;[vagrant@vagrant vagrant]$ &#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-the-process">
<h4>Finding the Process<a class="headerlink" href="#finding-the-process" title="Permalink to this headline">¶</a></h4>
<p>The shell client can send the <code class="docutils literal notranslate"><span class="pre">list</span></code> command over a new <code class="docutils literal notranslate"><span class="pre">channel_id</span></code>
to find this process and its information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Client</span><span class="p">:</span> <span class="p">{</span> <span class="mi">65</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The service responds with the list of current processes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">65</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="p">[</span><span class="mi">55</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/bin/sh&#39;</span><span class="p">,</span> <span class="n">pid</span> <span class="o">=</span> <span class="mi">26825</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-data-to-the-process">
<h4>Sending Data to the Process<a class="headerlink" href="#sending-data-to-the-process" title="Permalink to this headline">¶</a></h4>
<p>The shell client can use the <code class="docutils literal notranslate"><span class="pre">channel_id</span></code> to send data to the
<code class="docutils literal notranslate"><span class="pre">stdin</span></code> of the process.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Client</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;stdin&#39;</span><span class="p">,</span> <span class="s1">&#39;echo hello</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The server will write this data to the <code class="docutils literal notranslate"><span class="pre">stdin</span></code> of the process
and send back any data received over <code class="docutils literal notranslate"><span class="pre">stdout</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;echo hello</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;hello</span><span class="se">\r\n\027</span><span class="s1">kvagrant@vagrant:/home/vagrant</span><span class="se">\027\\</span><span class="s1">&#39;</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;[vagrant@vagrant vagrant]$ &#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="killing-the-process">
<h4>Killing the Process<a class="headerlink" href="#killing-the-process" title="Permalink to this headline">¶</a></h4>
<p>Once the shell client is finished it can use the <code class="docutils literal notranslate"><span class="pre">kill</span></code> command
to terminate the process.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Client</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;kill&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The service will terminate the process, respond with any data which was
sent via <code class="docutils literal notranslate"><span class="pre">stdout</span></code> or <code class="docutils literal notranslate"><span class="pre">stderr</span></code> and send the <code class="docutils literal notranslate"><span class="pre">exit</span></code> message.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="s1">&#39;logout</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="p">}</span>
<span class="n">Server</span><span class="p">:</span> <span class="p">{</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="future-messages">
<h2>Future Messages<a class="headerlink" href="#future-messages" title="Permalink to this headline">¶</a></h2>
<p>These messages may be implemented in the shell protocol in the future,
but are not implemented as of KubOS release v1.8.0.</p>
<div class="section" id="id1">
<h3>Spawn Process<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The spawn process is currently implemented, however the following
optional arguments are not currently implemented:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">pty</span></code> - A boolean specifying whether a new pty is needed</li>
<li><code class="docutils literal notranslate"><span class="pre">env</span></code> - An array of environment variable entries in the form <code class="docutils literal notranslate"><span class="pre">&quot;KEY=val&quot;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">cwd</span></code> - The current working directory of the child process</li>
<li><code class="docutils literal notranslate"><span class="pre">uid</span></code> - The uid of the process</li>
<li><code class="docutils literal notranslate"><span class="pre">gid</span></code> - The gid of the process</li>
<li><code class="docutils literal notranslate"><span class="pre">detached</span></code> - Determines if the child process should be detached from the service</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="resize-terminal">
<h3>Resize Terminal<a class="headerlink" href="#resize-terminal" title="Permalink to this headline">¶</a></h3>
<p>This message is sent to the shell service to resize the pseudo
terminal of a child process, if one exists. It contains a
channel ID, the string ‘resize’, the desired number of columns
and the desired number of rows.</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">channel_id,</span> <span class="pre">'resize',</span> <span class="pre">columns,</span> <span class="pre">rows</span> <span class="pre">}</span></code></div></blockquote>
<p>Example message - Resizing a pseudo terminal to 10x10:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">1,</span> <span class="pre">'resize',</span> <span class="pre">10,</span> <span class="pre">10</span> <span class="pre">}</span></code></div></blockquote>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../klb/configuring-kubos.html" class="btn btn-neutral float-right" title="Configuring Kubos Linux" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="file-protocol.html" class="btn btn-neutral" title="File Transfer Protocol" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Kubos Corporation.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.21.0+12',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>